- block:
    - name: checking command 'kibana'
      command: "/usr/share/kibana/bin/kibana -V"
      changed_when: false
      register: verChk
      failed_when: "elk_version > verChk.stdout"
  rescue:
    - include_tasks: '{{ ansible_os_family }}.yml'

- include_tasks: port_check.yml
  when: verChk.rc == 1

- name: update kibana configuration
  template:
    src: '{{ item }}.j2'
    dest: '/etc/kibana/{{ item }}'
  with_items:
    - kibana.yml
  notify: Restart kibana service
